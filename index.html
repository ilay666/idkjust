<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Clicker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .balance {
            font-size: 18px;
            font-weight: bold;
        }
        .energy {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .battery-container {
            width: 100px;
            height: 20px;
            border: 1px solid #ccc;
            border-radius: 3px;
            overflow: hidden;
        }
        .battery {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s;
        }
        .coin {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .coin img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .coin:active {
            transform: scale(0.95);
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .tab-button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .tab-content {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .task-button {
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="balance" id="balance">0 coins</div>
            <div class="energy">
                <div class="battery-container">
                    <div class="battery" id="battery"></div>
                </div>
                <span id="energy-counter">300/300</span>
            </div>
        </div>
        
        <div class="coin" id="coin">
            <img src="https://cdn-icons-png.flaticon.com/512/3523/3523067.png" alt="Coin">
        </div>
        
        <div class="tabs">
            <button class="tab-button" onclick="openTab('main')">Main</button>
            <button class="tab-button" onclick="openTab('withdraw')">Withdraw</button>
            <button class="tab-button" onclick="openTab('tasks')">Tasks</button>
            <button class="tab-button" onclick="openTab('daily')">Daily</button>
        </div>
        
        <div id="main-tab" class="tab-content">
            <h2>Click the coin to earn money!</h2>
            <p>Each click gives you <span id="click-power">0.01</span> coins</p>
        </div>
        
        <div id="withdraw-tab" class="tab-content" style="display:none;">
            <h2>Withdraw coins</h2>
            <p>Requirements:</p>
            <ul>
                <li>Minimum 100,000 coins</li>
                <li>10 referrals</li>
            </ul>
            <p>1 coin = 0.001 Telegram Stars</p>
            <button id="withdraw-button" class="tab-button">Withdraw</button>
            <div id="withdraw-status"></div>
        </div>
        
        <div id="tasks-tab" class="tab-content" style="display:none;">
            <h2>Tasks</h2>
            <div id="simple-tasks">
                <h3>Simple Tasks</h3>
                <div id="simple-tasks-list"></div>
            </div>
            <div id="bot-tasks">
                <h3>Bot Tasks</h3>
                <div id="bot-tasks-list"></div>
            </div>
        </div>
        
        <div id="daily-tab" class="tab-content" style="display:none;">
            <h2>Daily Reward</h2>
            <div id="daily-reward">
                <p>Come back every day to get rewards!</p>
                <button id="claim-daily" class="tab-button">Claim Daily Reward</button>
                <p id="streak-info"></p>
            </div>
        </div>
    </div>

    <script>
        let userData = {
            coins: 0,
            energy: 300,
            maxEnergy: 300,
            clickPower: 0.01,
            streakDays: 0
        };

        // Инициализация WebApp
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        // Получение данных пользователя
        function getUserData() {
            if (Telegram.WebApp.initDataUnsafe.user) {
                const user = Telegram.WebApp.initDataUnsafe.user;
                fetchUserData(user.id);
            }
        }

        // Запрос данных с сервера
        async function fetchUserData(userId) {
            try {
                const response = await fetch('https://your-server-url.com/get_user_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        action: 'get_user_data'
                    })
                });
                
                const data = await response.json();
                updateUserData(data);
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        // Обновление данных на странице
        function updateUserData(data) {
            userData = {
                coins: data.coins || 0,
                energy: data.energy || 0,
                maxEnergy: data.max_energy || 300,
                clickPower: data.click_power || 0.01,
                streakDays: data.streak_days || 0
            };

            document.getElementById('balance').textContent = userData.coins.toFixed(2) + ' coins';
            document.getElementById('energy-counter').textContent = `${userData.energy}/${userData.maxEnergy}`;
            document.getElementById('battery').style.width = `${(userData.energy / userData.maxEnergy) * 100}%`;
            document.getElementById('click-power').textContent = userData.clickPower.toFixed(2);
            
            // Обновление информации о серии
            if (userData.streakDays > 0) {
                document.getElementById('streak-info').textContent = `Current streak: ${userData.streakDays} days`;
            }
        }

        // Обработка клика по монетке
        document.getElementById('coin').addEventListener('click', async function() {
            if (userData.energy <= 0) {
                alert('Not enough energy!');
                return;
            }

            try {
                const user = Telegram.WebApp.initDataUnsafe.user;
                const response = await fetch('https://your-server-url.com/handle_click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: user.id,
                        action: 'click'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    userData.coins += userData.clickPower;
                    userData.energy--;
                    updateUserData(userData);
                    
                    // Анимация
                    const coin = document.getElementById('coin');
                    coin.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        coin.style.transform = 'scale(1)';
                    }, 100);
                }
            } catch (error) {
                console.error('Error handling click:', error);
            }
        });

        // Переключение вкладок
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            
            if (tabName === 'tasks') {
                loadTasks();
            }
        }

        // Загрузка заданий
        async function loadTasks() {
            try {
                const response = await fetch('https://your-server-url.com/get_tasks');
                const tasks = await response.json();
                
                const simpleTasksList = document.getElementById('simple-tasks-list');
                const botTasksList = document.getElementById('bot-tasks-list');
                
                simpleTasksList.innerHTML = '';
                botTasksList.innerHTML = '';
                
                tasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'task';
                    taskElement.innerHTML = `
                        <span>${task.description} (${task.reward} coins)</span>
                        <button class="task-button" onclick="completeTask(${task.task_id})">Complete</button>
                    `;
                    
                    if (task.task_type === 'channel') {
                        simpleTasksList.appendChild(taskElement);
                    } else {
                        botTasksList.appendChild(taskElement);
                    }
                });
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        // Завершение задания
        async function completeTask(taskId) {
            try {
                const user = Telegram.WebApp.initDataUnsafe.user;
                const response = await fetch('https://your-server-url.com/complete_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: user.id,
                        task_id: taskId
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`Task completed! You earned ${result.reward} coins`);
                    fetchUserData(user.id);
                    loadTasks();
                } else {
                    alert(result.message || 'Failed to complete task');
                }
            } catch (error) {
                console.error('Error completing task:', error);
            }
        }

        // Получение ежедневной награды
        document.getElementById('claim-daily').addEventListener('click', async function() {
            try {
                const user = Telegram.WebApp.initDataUnsafe.user;
                const response = await fetch('https://your-server-url.com/claim_daily', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: user.id
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`Daily reward claimed! You earned ${result.reward} coins`);
                    fetchUserData(user.id);
                } else {
                    alert(result.message || 'Failed to claim daily reward');
                }
            } catch (error) {
                console.error('Error claiming daily reward:', error);
            }
        });

        // Инициализация при загрузке
        window.onload = function() {
            getUserData();
            openTab('main');
            
            // Запуск обновления энергии каждую секунду
            setInterval(() => {
                if (userData.energy < userData.maxEnergy) {
                    userData.energy += 1;
                    updateUserData(userData);
                }
            }, 15000); // 15 секунд
        };
    </script>
</body>
</html>
